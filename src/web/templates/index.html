{% extends "base.html" %}

{% block content %}
<div class="status" id="status-container">
    <div class="status-item">
        <span class="status-label">WiFi Status:</span>
        <span class="status-value" id="wifi-status">Checking...</span>
    </div>
    <div class="status-item">
        <span class="status-label">Network:</span>
        <span class="status-value" id="wifi-ssid">-</span>
    </div>
    <div class="status-item">
        <span class="status-label">Internet:</span>
        <span class="status-value" id="internet-status">Checking...</span>
    </div>
    <div class="status-item">
        <span class="status-label">Startup Service:</span>
        <span class="status-value" id="startup-status">Checking...</span>
    </div>
</div>

<div style="margin-top: 20px;">
    <h3 style="color: #555; margin-bottom: 10px;">Current Startup Command:</h3>
    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: 'Courier New', monospace; word-break: break-all;">
        <span id="startup-command">{{ config.startup_command or 'Not configured' }}</span>
    </div>
</div>

<div style="margin-top: 30px; text-align: center;">
    <button onclick="refreshStatus()">Refresh Status</button>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function refreshStatus() {
        try {
            const data = await fetchJSON('/status');

            // Update WiFi status
            const wifiStatus = document.getElementById('wifi-status');
            const wifiSSID = document.getElementById('wifi-ssid');

            if (data.wifi_connected) {
                wifiStatus.textContent = 'Connected';
                wifiStatus.className = 'status-value connected';
                wifiSSID.textContent = data.wifi_ssid || '-';
            } else {
                wifiStatus.textContent = 'Disconnected';
                wifiStatus.className = 'status-value disconnected';
                wifiSSID.textContent = '-';
            }

            // Update internet status
            const internetStatus = document.getElementById('internet-status');
            if (data.internet) {
                internetStatus.textContent = 'Connected';
                internetStatus.className = 'status-value connected';
            } else {
                internetStatus.textContent = 'Disconnected';
                internetStatus.className = 'status-value disconnected';
            }

            // Update startup service status
            const startupStatus = document.getElementById('startup-status');
            if (data.startup_service) {
                startupStatus.textContent = 'Running';
                startupStatus.className = 'status-value connected';
            } else {
                startupStatus.textContent = 'Stopped';
                startupStatus.className = 'status-value disconnected';
            }

            // Update startup command
            const startupCommand = document.getElementById('startup-command');
            startupCommand.textContent = data.startup_command || 'Not configured';

        } catch (error) {
            console.error('Failed to refresh status:', error);
        }
    }

    // Refresh status on page load
    refreshStatus();

    // Auto-refresh every 10 seconds
    setInterval(refreshStatus, 10000);
</script>
{% endblock %}